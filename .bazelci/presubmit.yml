---
platforms:
  ubuntu1804:
    build_flags:
    - "--build_tag_filters=-nolinux"
    build_targets:
    - "..."
    test_flags:
    - "--features=race"
    - "--test_tag_filters=-nolinux"
    test_targets:
    - "..."
  ubuntu1604:
    build_flags:
    - "--build_tag_filters=-nolinux"
    build_targets:
    - "..."
    test_flags:
    - "--features=race"
    - "--test_tag_filters=-nolinux"
    test_targets:
    - "..."
  macos:
    build_flags:
    - "--build_tag_filters=-nomacos"
    build_targets:
    - "..."
    test_flags:
    - "--features=race"
    - "--test_tag_filters=-nomacos"
    test_targets:
    - "..."
  windows:
    build_flags:
    - "--build_tag_filters=-nowindows"
    build_targets:
    - "..."
    test_flags:
    - "--test_tag_filters=-nowindows"
    - "--experimental_enable_runfiles"
    # On Windows CI, bazel (bazelisk) needs %LocalAppData% to find the cache directory.
    # We invoke bazel in tests, so the tests need this, too.
    - "--test_env=LOCALAPPDATA"
    test_targets:
    - "..."
